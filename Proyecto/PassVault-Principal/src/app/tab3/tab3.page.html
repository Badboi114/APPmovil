<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Configuración</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="settings-content">
  <div class="settings-container">
    
    <!-- Información del Usuario -->
    <ion-card class="user-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="person-outline"></ion-icon>
          Perfil de Usuario (Debug: {{ currentUser ? 'Con datos' : 'Sin datos' }})
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <div *ngIf="!currentUser" style="text-align: center; padding: 20px; color: white;">
          <p>No hay datos de usuario disponibles</p>
          <ion-button fill="outline" color="light" (click)="loadCurrentUser()">
            Recargar Datos
          </ion-button>
        </div>
        
        <ion-list *ngIf="currentUser">
          <!-- Campo Nombre -->
          <ion-item>
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Nombre</h3>
              <p *ngIf="!isEditingName">{{ currentUser.name }}</p>
              <ion-input 
                *ngIf="isEditingName" 
                [(ngModel)]="editedUser.name" 
                placeholder="Ingresa tu nombre"
                fill="outline">
              </ion-input>
            </ion-label>
            <ion-button 
              *ngIf="!isEditingName" 
              slot="end" 
              fill="clear" 
              size="small"
              (click)="startEditingName()">
              <ion-icon name="create-outline"></ion-icon>
            </ion-button>
            <div *ngIf="isEditingName" slot="end" class="edit-actions">
              <ion-button 
                fill="clear" 
                size="small" 
                color="success"
                (click)="saveNameEdit()">
                <ion-icon name="checkmark-outline"></ion-icon>
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                color="medium"
                (click)="cancelNameEdit()">
                <ion-icon name="close-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
          
          <!-- Campo Email -->
          <ion-item>
            <ion-icon name="mail-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Correo Electrónico</h3>
              <p *ngIf="!isEditingEmail">{{ currentUser.email }}</p>
              <ion-input 
                *ngIf="isEditingEmail" 
                [(ngModel)]="editedUser.email" 
                type="email"
                placeholder="Ingresa tu email"
                fill="outline">
              </ion-input>
            </ion-label>
            <ion-button 
              *ngIf="!isEditingEmail" 
              slot="end" 
              fill="clear" 
              size="small"
              (click)="startEditingEmail()">
              <ion-icon name="create-outline"></ion-icon>
            </ion-button>
            <div *ngIf="isEditingEmail" slot="end" class="edit-actions">
              <ion-button 
                fill="clear" 
                size="small" 
                color="success"
                (click)="saveEmailEdit()">
                <ion-icon name="checkmark-outline"></ion-icon>
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                color="medium"
                (click)="cancelEmailEdit()">
                <ion-icon name="close-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
          
          <!-- Campo Fecha de Registro (No editable) -->
          <ion-item>
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Fecha de Registro</h3>
              <p>{{ currentUser.createdAt | date:'dd/MM/yyyy' }}</p>
            </ion-label>
          </ion-item>

          <!-- Campo PIN (Solo mostrar que existe) -->
          <ion-item>
            <ion-icon name="key-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>PIN de Seguridad</h3>
              <p>••••</p>
            </ion-label>
            <ion-button 
              slot="end" 
              fill="clear" 
              size="small"
              (click)="customizePin()">
              <ion-icon name="keypad-outline"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>
        
        <!-- Cambiar contraseña -->
        <div class="password-section">
          <ion-button 
            expand="block" 
            fill="outline" 
            color="warning"
            (click)="changePassword()">
            <ion-icon name="key-outline" slot="start"></ion-icon>
            Cambiar Contraseña
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Opciones de Seguridad -->
    <ion-card class="security-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          Seguridad
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-button 
          expand="block" 
          color="secondary" 
          fill="outline"
          (click)="customizePin()">
          <ion-icon name="keypad-outline" slot="start"></ion-icon>
          Personalizar PIN
        </ion-button>
        
        <ion-text color="medium">
          <p class="security-note">
            Personaliza tu PIN de seguridad de 4 dígitos para acceder a la aplicación.
          </p>
        </ion-text>
      </ion-card-content>
    </ion-card>

    <!-- Opciones de Cuenta -->
    <ion-card class="account-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="settings-outline"></ion-icon>
          Cuenta
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-button 
          expand="block" 
          color="warning" 
          fill="outline"
          (click)="goToAdmin()">
          <ion-icon name="settings-outline" slot="start"></ion-icon>
          Panel de Administración
        </ion-button>
        
        <ion-button 
          expand="block" 
          color="danger" 
          fill="outline"
          (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          Cerrar Sesión
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Información de la App -->
    <ion-card class="app-info-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle-outline"></ion-icon>
          Acerca de PassVault
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-text color="dark">
          <p>
            PassVault es tu compañero seguro para generar y administrar contraseñas.
            Mantén tus credenciales seguras con autenticación por PIN y encriptado AES-256-CBC con HMAC-SHA256.
          </p>
          <p><strong>Versión:</strong> 1.0.0</p>
        </ion-text>
      </ion-card-content>
    </ion-card>

  </div>
</ion-content>
